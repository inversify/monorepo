---
sidebar_position: 5
title: Middleware
---
import middlewareApiExpressSource from '@inversifyjs/http-code-examples/generated/examples/v0/middlewareApiExpressSetHeader.ts.txt';
import middlewareApiExpress4Source from '@inversifyjs/http-code-examples/generated/examples/v0/middlewareApiExpress4SetHeader.ts.txt';
import middlewareApiFastifySource from '@inversifyjs/http-code-examples/generated/examples/v0/middlewareApiFastifySetHeader.ts.txt';
import middlewareApiHonoSource from '@inversifyjs/http-code-examples/generated/examples/v0/middlewareApiHonoSetHeader.ts.txt';
import middlewareApiUwebsocketsSource from '@inversifyjs/http-code-examples/generated/examples/v0/middlewareApiUwebsocketsSetHeader.ts.txt';
import CodeBlock from '@theme/CodeBlock';
import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

# Middleware

Middleware run before or after your controller method, depending on the phase where you register them. They receive the native request/response types of the adapter you use.

```ts
interface Middleware<
  TRequest = any,
  TResponse = any,
  TNextFunction = any,
  TResult = any,
> {
  execute(
    request: TRequest,
    response: TResponse,
    next: TNextFunction,
  ): Promise<TResult> | TResult;
}
```

Specific adapters use their own request/response types:

<Tabs>
  <TabItem value="express4" label="Express 4">
```ts
type ExpressMiddleware = Middleware<
  express.Request,
  express.Response,
  express.NextFunction,
  void
>;
```
  </TabItem>
  <TabItem value="express5" label="Express 5">
```ts
type ExpressMiddleware = Middleware<
  express.Request,
  express.Response,
  express.NextFunction,
  void
>;
```
  </TabItem>
  <TabItem value="fastify" label="Fastify">
```ts
type FastifyMiddleware = Middleware<
  FastifyRequest,
  FastifyReply,
  () => void,
  void
>;
```
  </TabItem>
  <TabItem value="hono" label="Hono">
```ts
type HonoMiddleware = Middleware<
  HonoRequest,
  Context,
  Next,
  Response | undefined
>;
```
  </TabItem>
  <TabItem value="uwebsockets" label="uWebSockets.js">
```ts
type UwebSocketsMiddleware = Middleware<
  HttpRequest,
  HttpResponse,
  () => void,
  void
>;
```
  </TabItem>
</Tabs>

## execute

Handles the request and response objects. Use it to modify them or perform actions before passing control to the next middleware or the route handler.

## Adapter-specific examples

Each adapter exposes its own request/response types. Here is the same middleware that sets a custom header for each adapter.

<Tabs>
  <TabItem value="express4" label="Express 4">
    <CodeBlock language="ts">{middlewareApiExpress4Source}</CodeBlock>
  </TabItem>
  <TabItem value="express5" label="Express 5">
    <CodeBlock language="ts">{middlewareApiExpressSource}</CodeBlock>
  </TabItem>
  <TabItem value="fastify" label="Fastify">
    <CodeBlock language="ts">{middlewareApiFastifySource}</CodeBlock>
  </TabItem>
  <TabItem value="hono" label="Hono">
    <CodeBlock language="ts">{middlewareApiHonoSource}</CodeBlock>

    :::danger[Implementing a post handler middleware in Hono]

      If you are implementing a post handler middleware in Hono, the adapter already calls `next()` for you after the middleware execution. Do not call it again in your middleware implementation, or an Internal Server Error will occur.

    :::
  </TabItem>
  <TabItem value="uwebsockets" label="uWebSockets.js">
    <CodeBlock language="ts">{middlewareApiUwebsocketsSource}</CodeBlock>
  </TabItem>
</Tabs>

## Attaching middleware

Use the [ApplyMiddleware](../../api/decorators#applymiddleware) decorator at the controller level (applies to all routes) or at the method level (applies to one route).

Global middleware can be registered using the [InversifyHttpAdapter](../../api/inversify-http-adapter#applyglobalmiddleware).
